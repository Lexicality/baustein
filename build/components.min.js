!function(a,b){"function"==typeof define&&define.amd?define(b):a.components=b()}(this,function(){function a(a){return Object.prototype.toString.call(a).match(/\[object (.*?)\]/)[1].toLowerCase()}function b(b){return"object"===a(b)}function c(b){return"function"===a(b)}function d(a){return a&&(1===a.nodeType||9===a.nodeType)}function e(b){return"string"===a(b)}function f(){return this}function g(a){return a.replace(/\-(.)/g,function(a,b){return b.toUpperCase()})}function h(a){return A.call(arguments,1).forEach(function(c){if(b(c))for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}),a}function i(a,b){if(D)return D(a).closest(b)[0];for(;a&&a!==z.body;){if(j(a,b))return a;a=a.parentElement}return null}function j(a,b){var c="MatchesSelector",d=a["webkit"+c]||a["moz"+c]||a["ms"+c]||a["o"+c]||a.matchesSelector||a.matches;return d.call(a,b)}function k(a,b){var c,d=[];for(b&&(a=a.parentElement);a&&a!==z.body;)c=a.getAttribute(L),c&&d.push(F[c]),a=a.parentElement;return d}function l(a){var b,c;if(!d(a))return null;if(b=a.getAttribute(K),c=a.getAttribute(L),!b)return null;if(c)return F[c];if(!E[b])throw Error("No component has been registered with name "+b);return new E[b](a)}function m(a,b){var d,e=A.call(arguments,2),f=0;if(o(a)&&(a=[a]),!a)return this;for(d=a.length;d>f;f++)c(a[f][b])&&a[f][b].apply(a[f],e);return this}function n(a){for(var b,c,d={},e=0;e<a.attributes.length;e++)if(b=g(a.attributes[e].name),"dataComponentOption"===b.substring(0,19)){b=b[19].toLowerCase()+b.substring(20),c=a.attributes[e].value;try{c=JSON.parse(c)}catch(f){}d[b]=c}return d}function o(a){return a instanceof x}function p(a,b){var c,d,e,f,g,h,j,l,m,n,p,q=a.target,r=o(q),s=r?q.name:null,t=a.type;for(b=b?A.call(b):k(r?q.el:q,r);b.length;)if(c=b.shift(),d=c.events)for(f in d)j=f.split(":"),g=j.length>1?j[0]:null,h=j.length>1?j[1]:j[0],l=d[f],(h===t||H[t]===h)&&(g?r?g===s&&c[l](a):(e=i(q,g),e&&c[l](a,e)):c[l](a));if(m=G[a.type]||G[H[a.type]])for(n=0,p=m.length;p>n;n++)m[n].fn.call(m[n].ctx,a,z.body)}function q(a){a=d(a)?a:z.body;var b,c=A.call(a.querySelectorAll("["+K+"]"));return c.unshift(a),c.reduce(function(a,c){return b=l(c),b&&a.push(b),a},[])}function r(a,c){var d,f;if(b(a)&&(c=a,a=c.name),!e(a)||!a)throw Error('"'+a+'" is not a valid component name');if(E[a])throw Error("A component called "+a+" already exists");return c=c||{},d=function(){x.apply(this,arguments)},f=function(){},f.prototype=x.prototype,d.prototype=new f,d.prototype.name=a,h(d.prototype,c),E[a]=d,d}function s(){var a,b;for(a in M)b=-1!==["resize","scroll"].indexOf(a)?window:z.body,b.addEventListener(a,p,!!M[a])}function t(a){a=a||{},a.eventMappings&&(H=a.eventMappings),h(M,a.additionalEvents),q(),s()}function u(a){return v(a)[0]}function v(a){var b=[];for(var c in F)F[c]&&F[c].name===a&&b.push(F[c]);return b}function w(a){return v(a).forEach(function(a){a.destroy()}),this}function x(a,b){a||(a=this.createRootElement()),this._id=I++,F[this._id]=this,this.el=a,D&&(this.$el=D(el)),this.options=h({},c(this.defaultOptions)?this.defaultOptions():this.defaultOptions,n(this.el),b),a.setAttribute(K,this.name),a.setAttribute(L,this._id),this.init(),this.render()}var y=window,z=y.document,A=[].slice,B=[].filter,C=[].map,D=y.jQuery||y.Zepto||y.$,E={},F={},G={},H={},I=1,J="data-component-",K=J+"name",L=J+"id",M={click:!1,dblclick:!1,mousedown:!1,mouseup:!1,mousemove:!1,touchstart:!1,touchmove:!1,touchend:!1,keyup:!1,keydown:!1,error:!0,blur:!0,focus:!0,scroll:!0,submit:!0,change:!0,resize:!0};return x.prototype={name:"",tagName:"div",template:null,init:function(){return this},render:function(){return c(this.template)&&(this.el.innerHTML=this.template(this),this.parse()),this},parse:function(){return q(this.el),this},emit:function(a,b,c){b=b||{},b.target=this,b.type=a,b.customEvent=!0,p(b,c)},appendTo:function(a){return(a=d(a)?a:o(a)?a.el:null)?(this.beforeInsert(),a.appendChild(this.el),this.onInsert(),this.emit("inserted"),this):this},beforeInsert:f,onInsert:f,remove:function(a){if(!this.el||!this.el.parentElement)return this;a=a||k(this.el,!0);var b=q(this.el);return m(b,"beforeRemove"),this.el.parentElement.removeChild(this.el),m(b,"onRemove"),this.emit("remove",null,a),this},beforeRemove:f,onRemove:f,destroy:function(){var a;return F[this._id]?(a=k(this.el,!0),this.remove(a),m(q(this.el),"beforeDestroy"),this.emit("destroy",null,a),this.el=null,F[this._id]=null,null):null},beforeDestroy:f,createRootElement:function(){return z.createElement(this.tagName)},find:function(a){return this.$el?this.$el.find(a):this.el?A.call(this.el.querySelectorAll(a)):[]},findComponent:function(a){return l(this.find("["+K+"="+a+"]")[0])},findComponents:function(a){return C.call(this.find("["+K+"="+a+"]"),l)},invoke:m,setGlobalHandler:function(a,b){return G[a]=G[a]||[],G[a].push({fn:b,ctx:this}),this},releaseGlobalHandler:function(a,b){var c=G[a];return c?(G[a]=B.call(c,function(a){return a.fn!==b}),this):this}},{Component:x,init:t,bindEvents:s,handleEvent:p,parse:q,register:r,fromElement:l,isComponent:o,getInstancesOf:v,getInstanceOf:u,destroy:w}});