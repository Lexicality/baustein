define(["exports"],function(a){"use strict";function b(a){return Object.prototype.toString.call(a).match(/\[object (.*?)\]/)[1].toLowerCase()}function c(a){return"object"===b(a)}function d(a){return"function"===b(a)}function e(a){return a&&(1===a.nodeType||9===a.nodeType)}function f(a){return"string"===b(a)}function g(){return this}function h(a){return a.replace(/\-(.)/g,function(a,b){return b.toUpperCase()})}function i(a,b){return a?a.querySelectorAll(b):[]}function j(a){return a&&a.length?L.call(a):[]}function k(a){return L.call(arguments,1).forEach(function(b){if(c(b))for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function l(a,b){for(;a&&a!==K.body;){if(m(a,b))return a;a=a.parentElement}return null}function m(a,b){var c="MatchesSelector",d=a["webkit"+c]||a["moz"+c]||a["ms"+c]||a["o"+c]||a.matchesSelector||a.matches;return d.call(a,b)}function n(a){var b,c=[];if(a===J||a===K)return[];for(;e(a);)b=a.getAttribute(U),b&&R[b]&&c.push(R[b]),a=a.parentElement;return c}function o(a){var b,c;if(!e(a))return null;if(b=a.getAttribute("is"),c=a.getAttribute(U),!b)return null;if(c)return R[c];if(!Q[b])throw Error("No component has been registered with name "+b);return new Q[b](a)}function p(a,b){var c,e=L.call(arguments,2),f=0;if(r(a)&&(a=[a]),!a)return this;for(c=a.length;c>f;f++)d(a[f][b])&&a[f][b].apply(a[f],e);return this}function q(a){for(var b,c,d={},e=0;e<a.attributes.length;e++){b=h(a.attributes[e].name),c=a.attributes[e].value;try{c=JSON.parse(c)}catch(f){}d[b]=c}return d}function r(a){return a instanceof H}function s(a,b){var c,d,e,f,g,h,i,j,k,m,o,p=a.target,q=r(p),s=q?p.name:null,t=a.type;for(b||(b=n(q?p.el:p)),j=0,m=b.length;m>j;j++)if(c=b[j],d=c._events)for(k=0,o=d.length;o>k;k++)g=d[k][0],f=d[k][1],h=d[k][2],g===t&&(f?q?f===s&&h.call(c,a):(e=l(p,f),e&&h.call(c,a,e)):h.call(c,a));if(i=S[t])for(j=0,m=i.length;m>j;j++)i[j].fn.call(i[j].ctx,a,K.body)}function t(a){a=e(a)?a:K.body;var b,c=L.call(a.querySelectorAll("[is]"));return c.unshift(a),c.reduce(function(a,c){return b=o(c),b&&a.push(b),a},[])}function u(a,b){var d,e;if(c(a)&&(b=a,a=b.name),!f(a)||!a)throw Error('"'+a+'" is not a valid component name');if(Q[a])throw Error("A component called "+a+" already exists");return b=b||{},d=function(){H.apply(this,arguments)},e=function(){},e.prototype=H.prototype,d.prototype=new e,d.prototype.name=a,k(d.prototype,b),Q[a]=d,d}function v(a){G(a),Q[a]=null}function w(a){var b,c;for(b in V)c=-1!==["resize","scroll"].indexOf(b)?window:K.body,c[a](b,s,!!V[b])}function x(a){switch(a.type){case"DOMNodeInserted":A(a.target);break;case"DOMNodeRemoved":B(a.target)}}function y(){w("addEventListener"),window.MutationObserver?(I=new MutationObserver(function(a){L.call(a).forEach(function(a){L.call(a.removedNodes).forEach(B),L.call(a.addedNodes).forEach(A)})}),I.observe(document.body,{childList:!0,subtree:!0})):(document.body.addEventListener("DOMNodeInserted",x,!0),document.body.addEventListener("DOMNodeRemoved",x,!0))}function z(){w("removeEventListener"),I?I.disconnect():(document.body.removeEventListener("DOMNodeInserted",x,!0),document.body.removeEventListener("DOMNodeRemoved",x,!0))}function A(a){var b=t(a);p(b,"onInsert"),p(b,"emit","inserted")}function B(a){p(t(a),"onRemove")}function C(a){a=a||{},a.domQuery&&(O=a.domQuery),a.domWrapper&&(P=a.domWrapper),A(K.body),y()}function D(){for(var a in R)R[a]&&R[a].destroy();O=i,P=j,Q={},R={},z()}function E(a){return F(a)[0]}function F(a){var b=[];for(var c in R)R[c]&&R[c].name===a&&b.push(R[c]);return b}function G(a){return F(a).forEach(function(a){a.destroy()}),this}function H(a,b){1===arguments.length&&c(a)&&(b=a,a=this.createRootElement()),arguments.length||(a=this.createRootElement()),this._id=T++,this._events=[],this.el=a,this.$el=P([this.el]),this.options=k({},d(this.defaultOptions)?this.defaultOptions():this.defaultOptions,q(this.el),b),this.options.template&&(this.template=this.options.template),a.setAttribute("is",this.name),a.setAttribute(U,this._id),R[this._id]=this,this.init(),this.setupEvents(this.registerEvent.bind(this)),this.render()}if("undefined"==typeof window)throw new Error("components requires an environment with a window");var I,J=window,K=J.document,L=[].slice,M=[].filter,N=[].map,O=i,P=j,Q={},R={},S={},T=1,U="data-component-id",V={click:!1,dblclick:!1,mousedown:!1,mouseup:!1,mousemove:!1,mouseleave:!0,mouseenter:!0,touchstart:!1,touchmove:!1,touchend:!1,keyup:!1,keydown:!1,error:!0,blur:!0,focus:!0,scroll:!0,submit:!0,change:!0,resize:!0,load:!0};a.fromElement=o,a.isComponent=r,a.handleEvent=s,a.parse=t,a.register=u,a.unregister=v,a.bindEvents=y,a.unbindEvents=z,a.init=C,a.reset=D,a.getInstanceOf=E,a.getInstancesOf=F,a.destroy=G,a.Component=H,H.prototype={name:"",tagName:"div",template:null,init:function(){return this},setupEvents:g,render:function(){var a=this.template,b=d(a),c=f(a);return(b||c)&&(this.el.innerHTML=b?a.call(this,this):a),this},emit:function(a,b,c){b=b||{},b.target=b.target||this,b.type=a,b.customEvent=!0,s(b,c)},insertBefore:function(a){if(a=e(a)?a:r(a)?a.el:null,!a)return this;var b=a.parentElement;return b&&b.insertBefore(this.el,a),this},insertAfter:function(a){if(a=e(a)?a:r(a)?a.el:null,!a)return this;var b=a.parentNode;return b&&b.insertBefore(this.el,a.nextSibling),this},appendTo:function(a){return(a=e(a)?a:r(a)?a.el:null)?(a.appendChild(this.el),this):this},onInsert:g,remove:function(a){if(!this.el||!this.el.parentElement)return this;a=a||n(this.el,!0);t(this.el);return this.el.parentElement.removeChild(this.el),this},onRemove:g,destroy:function(){var a;return R[this._id]?(a=n(this.el,!0),this.remove(a),p(t(this.el),"beforeDestroy"),this.emit("destroy",null,a),this.el=null,R[this._id]=null,null):null},beforeDestroy:g,createRootElement:function(){return K.createElement(this.tagName)},find:function(a){return P(O(this.el,a))},findComponent:function(a){return o(this.find("[is="+a+"]")[0])},findComponents:function(a){return N.call(this.find("[is="+a+"]"),o)},invoke:p,registerEvent:function(a,b,c){return 2===arguments.length&&(c=b,b=null),this._events.push([a,b,c]),this},releaseEvent:function(a,b,c){d(b)&&!c&&(c=b,b=null),d(c)||(c=null),"undefined"==typeof b&&(b=null),this._events=M.call(this._events,function(d){var e=d[0],f=d[1],g=d[2];return c?!(e===a&&f===b&&g===c):!(e===a&&f===b)})},setGlobalHandler:function(a,b){return S[a]=S[a]||[],S[a].push({fn:b,ctx:this}),this},releaseGlobalHandler:function(a,b){var c=S[a],d=this;return c?(S[a]=M.call(c,function(a){return a.fn!==b||a.ctx!==d}),this):this}}});