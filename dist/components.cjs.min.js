"use strict";function type(a){return Object.prototype.toString.call(a).match(/\[object (.*?)\]/)[1].toLowerCase()}function isObject(a){return"object"===type(a)}function isFunction(a){return"function"===type(a)}function isElement(a){return a&&(1===a.nodeType||9===a.nodeType)}function isString(a){return"string"===type(a)}function noop(){return this}function toCamelCase(a){return a.replace(/\-(.)/g,function(a,b){return b.toUpperCase()})}function defaultDOMQuery(a,b){return a?a.querySelectorAll(b):[]}function defaultDOMWrapper(a){return a&&a.length?slice.call(a):[]}function extend(a){return slice.call(arguments,1).forEach(function(b){if(isObject(b))for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}),a}function closestElement(a,b){for(;a&&a!==doc.body;){if(matches(a,b))return a;a=a.parentElement}return null}function matches(a,b){var c="MatchesSelector",d=a["webkit"+c]||a["moz"+c]||a["ms"+c]||a["o"+c]||a.matchesSelector||a.matches;return d.call(a,b)}function parentComponents(a){var b,c=[];if(a===win||a===doc)return[];for(;isElement(a);)b=a.getAttribute(dataComponentIdAttribute),b&&componentInstances[b]&&c.push(componentInstances[b]),a=a.parentElement;return c}function fromElement(a){var b,c;if(!isElement(a))return null;if(b=a.getAttribute("is"),c=a.getAttribute(dataComponentIdAttribute),!b)return null;if(c)return componentInstances[c];if(!componentClasses[b])throw Error("No component has been registered with name "+b);return new componentClasses[b](a)}function invoke(a,b){var c,d=slice.call(arguments,2),e=0;if(isComponent(a)&&(a=[a]),!a)return this;for(c=a.length;c>e;e++)isFunction(a[e][b])&&a[e][b].apply(a[e],d);return this}function parseAttributes(a){for(var b,c,d={},e=0;e<a.attributes.length;e++){b=toCamelCase(a.attributes[e].name),c=a.attributes[e].value;try{c=JSON.parse(c)}catch(f){}d[b]=c}return d}function isComponent(a){return a instanceof Component}function handleEvent(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=a.target,o=isComponent(n),p=o?n.name:null,q=a.type;for(b||(b=parentComponents(o?n.el:n)),j=0,l=b.length;l>j;j++)if(c=b[j],d=c._events)for(k=0,m=d.length;m>k;k++)g=d[k][0],f=d[k][1],h=d[k][2],g===q&&(f?o?f===p&&h.call(c,a):(e=closestElement(n,f),e&&h.call(c,a,e)):h.call(c,a));if(i=globalHandlers[q])for(j=0,l=i.length;l>j;j++)i[j].fn.call(i[j].ctx,a,doc.body)}function parse(a){a=isElement(a)?a:doc.body;var b,c=slice.call(a.querySelectorAll("[is]"));return c.unshift(a),c.reduce(function(a,c){return b=fromElement(c),b&&a.push(b),a},[])}function register(a,b){var c,d;if(isObject(a)&&(b=a,a=b.name),!isString(a)||!a)throw Error('"'+a+'" is not a valid component name');if(componentClasses[a])throw Error("A component called "+a+" already exists");return b=b||{},c=function(){Component.apply(this,arguments)},d=function(){},d.prototype=Component.prototype,c.prototype=new d,c.prototype.name=a,extend(c.prototype,b),componentClasses[a]=c,c}function unregister(a){destroy(a),componentClasses[a]=null}function eventManager(a){var b,c;for(b in allEvents)c=-1!==["resize","scroll"].indexOf(b)?window:doc.body,c[a](b,handleEvent,!!allEvents[b])}function mutationEventHandler(a){switch(a.type){case"DOMNodeInserted":nodeInserted(a.target);break;case"DOMNodeRemoved":nodeRemoved(a.target)}}function bindEvents(){eventManager("addEventListener"),window.MutationObserver?(observer=new MutationObserver(function(a){slice.call(a).forEach(function(a){slice.call(a.removedNodes).forEach(nodeRemoved),slice.call(a.addedNodes).forEach(nodeInserted)})}),observer.observe(document.body,{childList:!0,subtree:!0})):(document.body.addEventListener("DOMNodeInserted",mutationEventHandler,!0),document.body.addEventListener("DOMNodeRemoved",mutationEventHandler,!0))}function unbindEvents(){eventManager("removeEventListener"),observer?observer.disconnect():(document.body.removeEventListener("DOMNodeInserted",mutationEventHandler,!0),document.body.removeEventListener("DOMNodeRemoved",mutationEventHandler,!0))}function nodeInserted(a){invoke(parse(a),"onInsert"),invoke(parse(a),"emit","inserted")}function nodeRemoved(a){invoke(parse(a),"onRemove"),invoke(parse(a),"emit","remove")}function init(a){a=a||{},a.domQuery&&(domQuery=a.domQuery),a.domWrapper&&(domWrapper=a.domWrapper),parse(),bindEvents()}function reset(){for(var a in componentInstances)componentInstances[a]&&componentInstances[a].destroy();domQuery=defaultDOMQuery,domWrapper=defaultDOMWrapper,componentClasses={},componentInstances={},unbindEvents()}function getInstanceOf(a){return getInstancesOf(a)[0]}function getInstancesOf(a){var b=[];for(var c in componentInstances)componentInstances[c]&&componentInstances[c].name===a&&b.push(componentInstances[c]);return b}function destroy(a){return getInstancesOf(a).forEach(function(a){a.destroy()}),this}function Component(a,b){1===arguments.length&&isObject(a)&&(b=a,a=this.createRootElement()),arguments.length||(a=this.createRootElement()),this._id=nextComponentId++,this._events=[],this.el=a,this.$el=domWrapper([this.el]),this.options=extend({},isFunction(this.defaultOptions)?this.defaultOptions():this.defaultOptions,parseAttributes(this.el),b),this.options.template&&(this.template=this.options.template),a.setAttribute("is",this.name),a.setAttribute(dataComponentIdAttribute,this._id),componentInstances[this._id]=this,this.init(),this.setupEvents(this.registerEvent.bind(this)),this.render()}if("undefined"==typeof window)throw new Error("components requires an environment with a window");var win=window,doc=win.document,slice=[].slice,filter=[].filter,map=[].map,observer,domQuery=defaultDOMQuery,domWrapper=defaultDOMWrapper,componentClasses={},componentInstances={},globalHandlers={},nextComponentId=1,dataComponentIdAttribute="data-component-id",allEvents={click:!1,dblclick:!1,mousedown:!1,mouseup:!1,mousemove:!1,mouseleave:!0,mouseenter:!0,touchstart:!1,touchmove:!1,touchend:!1,keyup:!1,keydown:!1,error:!0,blur:!0,focus:!0,scroll:!0,submit:!0,change:!0,resize:!0,load:!0};exports.fromElement=fromElement,exports.isComponent=isComponent,exports.handleEvent=handleEvent,exports.parse=parse,exports.register=register,exports.unregister=unregister,exports.bindEvents=bindEvents,exports.unbindEvents=unbindEvents,exports.init=init,exports.reset=reset,exports.getInstanceOf=getInstanceOf,exports.getInstancesOf=getInstancesOf,exports.destroy=destroy,exports.Component=Component,Component.prototype={name:"",tagName:"div",template:null,init:function(){return this},setupEvents:noop,render:function(){var a=this.template,b=isFunction(a),c=isString(a);return(b||c)&&(this.el.innerHTML=b?a.call(this,this):a),this},emit:function(a,b,c){b=b||{},b.target=b.target||this,b.type=a,b.customEvent=!0,handleEvent(b,c)},insertBefore:function(a){if(a=isElement(a)?a:isComponent(a)?a.el:null,!a)return this;var b=a.parentElement;return b&&(b.insertBefore(this.el,a),this.onInsert(),this.emit("inserted")),this},insertAfter:function(a){if(a=isElement(a)?a:isComponent(a)?a.el:null,!a)return this;var b=a.parentNode;return b&&(b.insertBefore(this.el,a.nextSibling),this.onInsert(),this.emit("inserted")),this},appendTo:function(a){return(a=isElement(a)?a:isComponent(a)?a.el:null)?(a.appendChild(this.el),this.onInsert(),this.emit("inserted"),this):this},onInsert:noop,remove:function(a){if(!this.el||!this.el.parentElement)return this;a=a||parentComponents(this.el,!0);var b=parse(this.el);return this.el.parentElement.removeChild(this.el),invoke(b,"onRemove"),this.emit("remove",null,a),this},onRemove:noop,destroy:function(){var a;return componentInstances[this._id]?(a=parentComponents(this.el,!0),this.remove(a),invoke(parse(this.el),"beforeDestroy"),this.emit("destroy",null,a),this.el=null,componentInstances[this._id]=null,null):null},beforeDestroy:noop,createRootElement:function(){return doc.createElement(this.tagName)},find:function(a){return domWrapper(domQuery(this.el,a))},findComponent:function(a){return fromElement(this.find("[is="+a+"]")[0])},findComponents:function(a){return map.call(this.find("[is="+a+"]"),fromElement)},invoke:invoke,registerEvent:function(a,b,c){return 2===arguments.length&&(c=b,b=null),this._events.push([a,b,c]),this},releaseEvent:function(a,b,c){isFunction(b)&&!c&&(c=b,b=null),isFunction(c)||(c=null),"undefined"==typeof b&&(b=null),this._events=filter.call(this._events,function(d){var e=d[0],f=d[1],g=d[2];return c?!(e===a&&f===b&&g===c):!(e===a&&f===b)})},setGlobalHandler:function(a,b){return globalHandlers[a]=globalHandlers[a]||[],globalHandlers[a].push({fn:b,ctx:this}),this},releaseGlobalHandler:function(a,b){var c=globalHandlers[a],d=this;return c?(globalHandlers[a]=filter.call(c,function(a){return a.fn!==b||a.ctx!==d}),this):this}};