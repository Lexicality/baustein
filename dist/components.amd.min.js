define(["exports"],function(a){"use strict";function b(a){return Object.prototype.toString.call(a).match(/\[object (.*?)\]/)[1].toLowerCase()}function c(a){return"object"===b(a)}function d(a){return"function"===b(a)}function e(a){return a&&(1===a.nodeType||9===a.nodeType)}function f(a){return"string"===b(a)}function g(){return this}function h(a){return a.replace(/\-(.)/g,function(a,b){return b.toUpperCase()})}function i(a,b){return a?a.querySelectorAll(b):[]}function j(a){return a&&a.length?H.call(a):[]}function k(a){return H.call(arguments,1).forEach(function(b){if(c(b))for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}),a}function l(a,b){for(;a&&a!==G.body;){if(m(a,b))return a;a=a.parentElement}return null}function m(a,b){var c="MatchesSelector",d=a["webkit"+c]||a["moz"+c]||a["ms"+c]||a["o"+c]||a.matchesSelector||a.matches;return d.call(a,b)}function n(a){var b,c=[];if(a===F||a===G)return[];for(;e(a);)b=a.getAttribute(Q),b&&N[b]&&c.push(N[b]),a=a.parentElement;return c}function o(a){var b,c;if(!e(a))return null;if(b=a.getAttribute("is"),c=a.getAttribute(Q),!b)return null;if(c)return N[c];if(!M[b])throw Error("No component has been registered with name "+b);return new M[b](a)}function p(a,b){var c,e=H.call(arguments,2),f=0;if(r(a)&&(a=[a]),!a)return this;for(c=a.length;c>f;f++)d(a[f][b])&&a[f][b].apply(a[f],e);return this}function q(a){for(var b,c,d={},e=0;e<a.attributes.length;e++){b=h(a.attributes[e].name),c=a.attributes[e].value;try{c=JSON.parse(c)}catch(f){}d[b]=c}return d}function r(a){return a instanceof E}function s(a,b){var c,d,e,f,g,h,i,j,k,m,o,p=a.target,q=r(p),s=q?p.name:null,t=a.type;for(b||(b=n(q?p.el:p)),j=0,m=b.length;m>j;j++)if(c=b[j],d=c._events)for(k=0,o=d.length;o>k;k++)g=d[k][0],f=d[k][1],h=d[k][2],g===t&&(f?q?f===s&&h.call(c,a):(e=l(p,f),e&&h.call(c,a,e)):h.call(c,a));if(i=O[t])for(j=0,m=i.length;m>j;j++)i[j].fn.call(i[j].ctx,a,G.body)}function t(a){a=e(a)?a:G.body;var b,c=H.call(a.querySelectorAll("[is]"));return c.unshift(a),c.reduce(function(a,c){return b=o(c),b&&a.push(b),a},[])}function u(a,b){var d,e;if(c(a)&&(b=a,a=b.name),!f(a)||!a)throw Error('"'+a+'" is not a valid component name');if(M[a])throw Error("A component called "+a+" already exists");return b=b||{},d=function(){E.apply(this,arguments)},e=function(){},e.prototype=E.prototype,d.prototype=new e,d.prototype.name=a,k(d.prototype,b),M[a]=d,d}function v(a){D(a),M[a]=null}function w(a){var b,c;for(b in R)c=-1!==["resize","scroll"].indexOf(b)?window:G.body,c[a](b,s,!!R[b])}function x(){w("addEventListener")}function y(){w("removeEventListener")}function z(a){a=a||{},a.domQuery&&(K=a.domQuery),a.domWrapper&&(L=a.domWrapper),t(),x()}function A(){for(var a in N)N[a]&&N[a].destroy();K=i,L=j,M={},N={},y()}function B(a){return C(a)[0]}function C(a){var b=[];for(var c in N)N[c]&&N[c].name===a&&b.push(N[c]);return b}function D(a){return C(a).forEach(function(a){a.destroy()}),S}function E(a,b){1===arguments.length&&c(a)&&(b=a,a=this.createRootElement()),arguments.length||(a=this.createRootElement()),this._id=P++,this._events=[],this.el=a,this.$el=L([this.el]),this.options=k({},d(this.defaultOptions)?this.defaultOptions():this.defaultOptions,q(this.el),b),this.options.template&&(this.template=this.options.template),a.setAttribute("is",this.name),a.setAttribute(Q,this._id),N[this._id]=this,this.init(),this.setupEvents(this.registerEvent.bind(this)),this.render()}if("undefined"==typeof window)throw new Error("components requires an environment with a window");var F=window,G=F.document,H=[].slice,I=[].filter,J=[].map,K=i,L=j,M={},N={},O={},P=1,Q="data-component-id",R={click:!1,dblclick:!1,mousedown:!1,mouseup:!1,mousemove:!1,mouseleave:!0,mouseenter:!0,touchstart:!1,touchmove:!1,touchend:!1,keyup:!1,keydown:!1,error:!0,blur:!0,focus:!0,scroll:!0,submit:!0,change:!0,resize:!0,load:!0};E.prototype={name:"",tagName:"div",template:null,init:function(){return this},setupEvents:g,render:function(){var a=this.template,b=d(a),c=f(a);return(b||c)&&(this.el.innerHTML=b?a(this):a,this.parse()),this},parse:function(){return t(this.el),this},emit:function(a,b,c){b=b||{},b.target=b.target||this,b.type=a,b.customEvent=!0,s(b,c)},appendTo:function(a){return(a=e(a)?a:r(a)?a.el:null)?(this.beforeInsert(),a.appendChild(this.el),this.onInsert(),this.emit("inserted"),this):this},beforeInsert:g,onInsert:g,remove:function(a){if(!this.el||!this.el.parentElement)return this;a=a||n(this.el,!0);var b=t(this.el);return p(b,"beforeRemove"),this.el.parentElement.removeChild(this.el),p(b,"onRemove"),this.emit("remove",null,a),this},beforeRemove:g,onRemove:g,destroy:function(){var a;return N[this._id]?(a=n(this.el,!0),this.remove(a),p(t(this.el),"beforeDestroy"),this.emit("destroy",null,a),this.el=null,N[this._id]=null,null):null},beforeDestroy:g,createRootElement:function(){return G.createElement(this.tagName)},find:function(a){return L(K(this.el,a))},findComponent:function(a){return o(this.find("[is="+a+"]")[0])},findComponents:function(a){return J.call(this.find("[is="+a+"]"),o)},invoke:p,registerEvent:function(a,b,c){return 2===arguments.length&&(c=b,b=null),this._events.push([a,b,c]),this},releaseEvent:function(a,b,c){d(b)&&!c&&(c=b,b=null),d(c)||(c=null),"undefined"==typeof b&&(b=null),this._events=I.call(this._events,function(d){var e=d[0],f=d[1],g=d[2];return c?!(e===a&&f===b&&g===c):!(e===a&&f===b)})},setGlobalHandler:function(a,b){return O[a]=O[a]||[],O[a].push({fn:b,ctx:this}),this},releaseGlobalHandler:function(a,b){var c=O[a],d=this;return c?(O[a]=I.call(c,function(a){return a.fn!==b||a.ctx!==d}),this):this}};var S={Component:E,init:z,reset:A,bindEvents:x,handleEvent:s,parse:t,register:u,unregister:v,fromElement:o,isComponent:r,getInstancesOf:C,getInstanceOf:B,destroy:D};a.components=S});